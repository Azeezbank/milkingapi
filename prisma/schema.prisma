generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Attendance {
  id        String        @id @db.Uuid
  date      DateTime
  status    UserAttendace @default(Absent)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  userId    String        @db.Uuid
  User      User          @relation(fields: [userId], references: [id])
  @@unique([userId, date])
}

model User {
  id         String       @id @db.Uuid
  name       String
  email      String       @unique
  phone      String       @unique
  username   String       @unique
  password   String
  role       String
  superRole  String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  Attendance Attendance[]
  workOffDays    WorkOffDays[]
}

enum UserAttendace {
  Present
  Absent
}

model Animals {
  id     String   @id     @db.Uuid
  animalTag      String 
  createdAt    DateTime   @default(now())
  updatedAt    DateTime    @updatedAt
  milkRecord   MilkRecord[]
}

model MilkRecord {
  id    String   @id     @db.Uuid
  date    DateTime
  animalTag      String
  animalId    String    @db.Uuid
  animal    Animals   @relation(fields: [animalId], references: [id])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime   @updatedAt
  session     Milksessions[]
  
  @@unique([animalId, date])
}

model Milksessions {
  id      String     @id    @db.Uuid
  time     DateTime
  period    String
  quantity    Decimal    @db.Decimal(10,2)
  recordId    String     @db.Uuid
  recorder     String
  record      MilkRecord    @relation(fields: [recordId], references: [id])
  createdAt    DateTime    @default(now())
  updatedAt    DateTime   @updatedAt

   @@unique([recordId, period])
}


model WorkOffDays {
  id     String   @id    @db.Uuid
  userId   String   @db.Uuid
  date     DateTime
  month    Int
  year     Int
  used     Boolean  @default(false)
  usedAt    DateTime?
  createdAt   DateTime   @default(now())
  user       User     @relation(fields: [userId], references: [id])
  
  @@unique([userId, date])
}

model WorkOffSettings {
  id        String   @id @db.Uuid
  month     Int
  year      Int
  maxDays   Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([month, year])
}